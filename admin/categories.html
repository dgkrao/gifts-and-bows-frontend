<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Categories | Gifts_and_Bows</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- STYLES -->
  <link rel="stylesheet" href="../css/main.css">
  <link rel="stylesheet" href="../css/admin.css">

  <!-- CORE JS -->
  <script defer src="../js/app.js"></script>
</head>
<body>

<!-- ================= ADMIN NAVBAR ================= -->
<header class="admin-navbar">
  <div class="admin-nav-container">
    <div class="admin-logo">Gifts_and_Bows · Admin</div>
    <div class="admin-hamburger" onclick="toggleAdminMenu()">☰</div>

    <nav class="admin-nav" id="adminNav">
      <a href="dashboard.html">Dashboard</a>
      <a href="categories.html" class="active">Categories</a>
      <a href="products.html">Products</a>
      <a href="orders.html">Orders</a>
      <a href="feedback.html">Feedback</a>
      <a href="site-settings.html">Settings</a>
      <a href="#" onclick="logout()">Logout</a>
    </nav>
  </div>
</header>

<!-- ================= MAIN ================= -->
<main class="admin-container">

  <h1 class="admin-title">Manage Categories</h1>
  <p class="admin-subtitle">Add or remove product categories</p>

  <!-- ADD CATEGORY -->
  <div class="admin-card">
    <h3>Add New Category</h3>

    <input
      id="categoryName"
      type="text"
      placeholder="Category name"
    />

    <button class="admin-btn" onclick="addCategory()">
      Add Category
    </button>
  </div>

  <!-- CATEGORY LIST -->
  <div class="admin-card">
    <h3>Existing Categories</h3>
    <ul id="categoryList" class="admin-list"></ul>
  </div>

</main>

<footer class="footer"></footer>

<!-- ================= SCRIPT ================= -->
<script>
/* =====================================================
   GLOBAL API BASE (PRODUCTION)
   ===================================================== */

const API_BASE = "https://gifts-and-bows-backend.onrender.com";
const ADMIN_API = `${API_BASE}/api/admin/categories`;

document.addEventListener("DOMContentLoaded", loadCategories);

/* =====================================================
   LOAD CATEGORIES
   ===================================================== */
function loadCategories() {
  fetch(ADMIN_API, {
    headers: authHeaders("GET")
  })
    .then(res => {
      if (!res.ok) throw new Error("Failed to load categories");
      return res.json();
    })
    .then(data => {
      const list = document.getElementById("categoryList");
      list.innerHTML = "";

      data.forEach(cat => {
        list.innerHTML += `
          <li>
            <span>${cat.name}</span>
            <button class="danger" onclick="deleteCategory(${cat.id})">
              Delete
            </button>
          </li>
        `;
      });
    })
    .catch(err => alert(err.message));
}

/* =====================================================
   ADD CATEGORY
   ===================================================== */
function addCategory() {
  const nameInput = document.getElementById("categoryName");
  const name = nameInput.value.trim();

  if (!name) {
    alert("Category name required");
    return;
  }

  fetch(ADMIN_API, {
    method: "POST",
    headers: authHeaders("POST"),
    body: JSON.stringify({ name })
  })
    .then(res => {
      if (!res.ok) throw new Error("Failed to add category");
      nameInput.value = "";
      loadCategories();
    })
    .catch(err => alert(err.message));
}

/* =====================================================
   DELETE CATEGORY
   ===================================================== */
function deleteCategory(id) {
  if (!confirm("Delete this category?")) return;

  fetch(`${ADMIN_API}/${id}`, {
    method: "DELETE",
    headers: authHeaders("DELETE")
  })
    .then(res => {
      if (!res.ok) throw new Error("Delete failed");
      loadCategories();
    })
    .catch(err => alert(err.message));
}
</script>

</body>
</html>
