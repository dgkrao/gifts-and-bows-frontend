<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Categories | Gifts_and_Bows</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="../css/main.css">
  <link rel="stylesheet" href="../css/admin.css">

  <!-- MUST LOAD APP.JS -->
  <script defer src="../js/app.js"></script>
</head>
<body>

<header class="admin-navbar">
  <div class="admin-nav-container">
    <div class="admin-logo">Gifts_and_Bows · Admin</div>
    <div class="admin-hamburger" onclick="toggleAdminMenu()">☰</div>

    <nav class="admin-nav" id="adminNav">
      <a href="dashboard.html">Dashboard</a>
      <a href="categories.html" class="active">Categories</a>
      <a href="products.html">Products</a>
      <a href="orders.html">Orders</a>
      <a href="feedback.html">Feedback</a>
      <a href="site-settings.html">Settings</a>
      <a href="#" onclick="logout()">Logout</a>
    </nav>
  </div>
</header>

<main class="admin-container">

  <h1 class="admin-title">Manage Categories</h1>
  <p class="admin-subtitle">Add or remove product categories</p>

  <div class="admin-card">
    <h3>Add New Category</h3>
    <input id="categoryName" type="text" placeholder="Category name">
    <button class="admin-btn" onclick="addCategory()">Add Category</button>
  </div>

  <div class="admin-card">
    <h3>Existing Categories</h3>
    <ul id="categoryList" class="admin-list"></ul>
  </div>

</main>

<footer class="footer"></footer>

<script>
const ADMIN_API = API_BASE + "/admin/categories";

document.addEventListener("DOMContentLoaded", loadCategories);

function loadCategories() {
  fetch(ADMIN_API, { headers: authHeaders("GET") })
    .then(res => res.json())
    .then(data => {
      const list = document.getElementById("categoryList");
      list.innerHTML = "";
      data.forEach(cat => {
        list.innerHTML += `
          <li>
            <span>${cat.name}</span>
            <button class="danger" onclick="deleteCategory(${cat.id})">Delete</button>
          </li>
        `;
      });
    });
}

function addCategory() {
  const name = document.getElementById("categoryName").value.trim();
  if (!name) return alert("Category name required");

  fetch(ADMIN_API, {
    method: "POST",
    headers: authHeaders("POST"),
    body: JSON.stringify({ name })
  })
    .then(res => {
      if (!res.ok) throw new Error();
      document.getElementById("categoryName").value = "";
      loadCategories();
    })
    .catch(() => alert("Failed to add category"));
}

function deleteCategory(id) {
  if (!confirm("Delete this category?")) return;

  fetch(`${ADMIN_API}/${id}`, {
    method: "DELETE",
    headers: authHeaders("DELETE")
  })
    .then(res => {
      if (!res.ok) throw new Error();
      loadCategories();
    })
    .catch(() => alert("Delete failed"));
}
</script>

</body>
</html>
